---

---

<button
  id="theme-toggle"
  class="relative w-16 h-8 rounded-full border-2 transition-all duration-300"
  aria-label="Changer de thème"
>
  <div
    id="toggle-indicator"
    class="absolute top-0.5 left-0.5 w-6 h-6 rounded-full transition-all duration-300 flex items-center justify-center"
  >
    <svg
      class="sun-icon w-4 h-4 transition-all duration-300"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2.5"
      stroke-linecap="round"
    >
      <circle cx="12" cy="12" r="4"></circle>
      <line x1="12" y1="2" x2="12" y2="4"></line>
      <line x1="12" y1="20" x2="12" y2="22"></line>
      <line x1="4.93" y1="4.93" x2="6.34" y2="6.34"></line>
      <line x1="17.66" y1="17.66" x2="19.07" y2="19.07"></line>
      <line x1="2" y1="12" x2="4" y2="12"></line>
      <line x1="20" y1="12" x2="22" y2="12"></line>
      <line x1="4.93" y1="19.07" x2="6.34" y2="17.66"></line>
      <line x1="17.66" y1="6.34" x2="19.07" y2="4.93"></line>
    </svg>
    <svg
      class="moon-icon hidden w-4 h-4 transition-all duration-300"
      xmlns="http://www.w3.org/2000/svg"
      fill="currentColor"
      viewBox="0 0 24 24"
    >
      <path
        d="M21.64 13a1 1 0 0 0-1.05-.14 8.05 8.05 0 0 1-3.37.73 8.15 8.15 0 0 1-8.14-8.1 8.59 8.59 0 0 1 .25-2A1 1 0 0 0 8 2.36a10.14 10.14 0 1 0 14 11.69 1 1 0 0 0-.36-1.05z"
      ></path>
    </svg>
  </div>
</button>

<style>
  #theme-toggle {
    cursor: pointer;
    background: var(--b1);
    border-color: var(--bc);
    box-shadow: 3px 3px 0px 0px var(--p);
  }

  #toggle-indicator {
    background: var(--p);
    color: var(--b1);
    transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55), background-color 0.3s ease;
  }

  /* Icônes gérées par les classes hidden ajoutées par le script Layout.astro */
  .sun-icon,
  .moon-icon {
    transition: opacity 0.3s ease;
  }
</style>

<script is:inline>
  // Initialiser IMMÉDIATEMENT l'état du toggle (avant DOMContentLoaded)
  (function() {
    const isDark = window.__isDarkMode || localStorage.getItem("darkMode") === "true";
    
    // Appliquer l'état dès que les éléments existent
    function initToggle() {
      const indicator = document.getElementById("toggle-indicator");
      const sunIcon = document.querySelector(".sun-icon");
      const moonIcon = document.querySelector(".moon-icon");
      
      if (indicator && sunIcon && moonIcon) {
        if (isDark) {
          indicator.style.transform = "translateX(32px)";
          sunIcon.classList.add("hidden");
          moonIcon.classList.remove("hidden");
        } else {
          indicator.style.transform = "translateX(0px)";
          sunIcon.classList.remove("hidden");
          moonIcon.classList.add("hidden");
        }
        return true;
      }
      return false;
    }
    
    // Essayer immédiatement
    if (!initToggle()) {
      // Si pas encore prêt, réessayer au DOMContentLoaded
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initToggle);
      } else {
        initToggle();
      }
    }
  })();
</script>

<script>
  const toggleButton = document.getElementById("theme-toggle");
  const indicator = document.getElementById("toggle-indicator");

  toggleButton?.addEventListener("click", () => {
    if (typeof window.changeTheme === "function") {
      window.changeTheme();
      updateIndicatorPosition();
    }
  });
  
  function updateIndicatorPosition() {
    const savedDarkMode = localStorage.getItem("darkMode") === "true";
    const sunIcon = document.querySelector(".sun-icon");
    const moonIcon = document.querySelector(".moon-icon");
    
    if (indicator) {
      if (savedDarkMode) {
        indicator.style.transform = "translateX(32px)";
        sunIcon?.classList.add("hidden");
        moonIcon?.classList.remove("hidden");
      } else {
        indicator.style.transform = "translateX(0px)";
        sunIcon?.classList.remove("hidden");
        moonIcon?.classList.add("hidden");
      }
    }
  }
  
  window.addEventListener("themeChanged", updateIndicatorPosition);
</script>
