---
import type { ThemeName } from "../types";

interface Props {
  label?: string;
  background?: string;
  shadowColor?: string;
  href?: string;
  onClick?: string;
  type?: "button" | "submit" | "reset";
  disabled?: boolean;
  className?: string;
  theme?: ThemeName;
}

const {
  label = "Bouton",
  background = "var(--color-white)",
  shadowColor,
  href,
  onClick,
  type = "button",
  disabled = false,
  className = "",
  theme = "cyberpunk",
} = Astro.props;

const btnClass = `
  inline-flex
  h-[45px]
  px-8
  justify-center
  items-center
  text-white
  font-primary 
  relative 
  transition-all 
  duration-200
  cursor-pointer
  btn-hover
  theme-${theme}
  ${className}
`.trim();
---

<!-- Button -->
<style>
  /* État par défaut - fond dégradé avec couleurs du thème */
  .btn-hover {
    background: radial-gradient(circle, var(--p), var(--s));
    box-shadow: -5px 5px 0 0 #000;
    text-shadow: none;
    transition: box-shadow 0.3s ease, filter 0.3s ease;
    position: relative;
    overflow: hidden;
    filter: drop-shadow(
      0 8px 16px var(--accent-glow, var(--glow, rgba(0, 0, 0, 0.3)))
    );
  }

  .btn-hover::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: radial-gradient(circle, #ffffff, #f0f0f0);
    transform: translate(-50%, -50%);
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    border-radius: 50%;
    z-index: 0;
  }

  .btn-hover:hover::before {
    width: 120%;
    height: 300%;
  }

  /* Au hover - ombre colorée */
  .btn-hover:hover {
    box-shadow: -5px 5px 0 0 var(--p);
    filter: none;
  }

  /* Contenu du bouton */
  .btn-text {
    position: relative;
    z-index: 1;
    display: inline-block;
    transition: color 0.3s ease, text-shadow 0.3s ease;
  }

  /* Variante Hero - couleurs inversées */
  .btn-hover.hero-button {
    background: radial-gradient(circle, #ffffff, #f0f0f0);
    box-shadow: -5px 5px 0 0 var(--p);
    text-shadow: none;
  }

  .btn-hover.hero-button::before {
    background: radial-gradient(circle, var(--p), var(--s));
  }

  .btn-hover.hero-button:hover {
    box-shadow: -5px 5px 0 0 var(--color-white);
  }

  .btn-hover.hero-button .btn-text {
    color: #181818;
  }
</style>

{
  href ? (
    <a {href} class={btnClass} role="button" onclick={onClick}>
      <span class="btn-text"><slot>{label}</slot></span>
    </a>
  ) : (
    <button class={btnClass} {type} {disabled} onclick={onClick}>
      <span class="btn-text"><slot>{label}</slot></span>
    </button>
  )
}

<script is:inline>
  function initButtons() {
    const buttons = document.querySelectorAll(".btn-hover");
    
    buttons.forEach((btn) => {
      btn.addEventListener("mouseenter", () => {
        // Vérifier en temps réel si c'est un hero button
        const isHeroButton = btn.classList.contains("hero-button");
        const textEl = btn.querySelector(".btn-text");
        
        if (textEl) {
          if (isHeroButton) {
            // Hero button: noir → blanc sans ombre
            textEl.style.color = "white";
            textEl.style.textShadow = "none";
          } else {
            // Bouton normal: couleurs du thème → noir sans ombre
            textEl.style.color = "#181818";
            textEl.style.textShadow = "none";
          }
        }
      });
      
      btn.addEventListener("mouseleave", () => {
        // Vérifier en temps réel si c'est un hero button
        const isHeroButton = btn.classList.contains("hero-button");
        const textEl = btn.querySelector(".btn-text");
        
        if (textEl) {
          if (isHeroButton) {
            // Hero button: retour au noir sans ombre
            textEl.style.color = "#181818";
            textEl.style.textShadow = "none";
          } else {
            // Bouton normal: retour au blanc sans ombre
            textEl.style.color = "white";
            textEl.style.textShadow = "none";
          }
        }
      });
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initButtons);
  } else {
    initButtons();
  }
  
  // Réinitialiser après navigation
  document.addEventListener("astro:page-load", initButtons);
</script>
